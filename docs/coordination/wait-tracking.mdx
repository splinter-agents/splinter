---
title: Wait Tracking
description: Track why agents are idle
---

# Wait Tracking

When an agent is idle, know why it's waiting.

## Usage

```python
from splinter.coordination import WaitTracker, WaitReason

tracker = WaitTracker()

# Agent starts waiting
tracker.start_waiting(
    agent_id="writer",
    reason=WaitReason.DEPENDENCY,
    waiting_for="researcher",
)

# Check status
if tracker.is_waiting("writer"):
    state = tracker.get_wait_state("writer")
    print(f"Waiting for: {state.waiting_for}")
    print(f"Reason: {state.reason}")
    print(f"Since: {state.since}")

# Agent stops waiting
tracker.stop_waiting("writer")
```

## Wait Reasons

| Reason | Description |
|--------|-------------|
| `DEPENDENCY` | Waiting for another agent |
| `RESOURCE` | Waiting for resource |
| `APPROVAL` | Waiting for human approval |
| `RATE_LIMIT` | Waiting due to rate limit |
| `CIRCUIT_OPEN` | Waiting for circuit breaker |
| `SCHEDULED` | Waiting for scheduled time |
| `CONDITION` | Waiting for condition |
| `UNKNOWN` | Unknown reason |

## Query Waiting Agents

```python
# Get all waiting agents
all_waiting = tracker.get_all_waiting()

for state in all_waiting:
    print(f"{state.agent_id}: waiting for {state.waiting_for}")

# Get agents waiting for specific target
waiting_for_researcher = tracker.get_waiting_for("researcher")

# Get agents waiting for specific reason
rate_limited = tracker.get_by_reason(WaitReason.RATE_LIMIT)
```

## With Metadata

```python
tracker.start_waiting(
    agent_id="writer",
    reason=WaitReason.RATE_LIMIT,
    waiting_for="api_quota",
    metadata={
        "retry_after": 60,
        "limit": 100,
        "current": 100,
    },
)
```

## Callbacks

```python
def on_wait_start(state):
    print(f"{state.agent_id} started waiting for {state.waiting_for}")

def on_wait_end(agent_id, state):
    duration = (datetime.now() - state.since).seconds
    print(f"{agent_id} waited {duration}s")

tracker = WaitTracker(
    on_wait_start=on_wait_start,
    on_wait_end=on_wait_end,
)
```

## Wait State Properties

```python
state = tracker.get_wait_state("writer")

print(state.agent_id)     # "writer"
print(state.reason)       # WaitReason.DEPENDENCY
print(state.waiting_for)  # "researcher"
print(state.since)        # datetime when started waiting
print(state.metadata)     # Additional data
```
