---
title: Loop Detection
description: Detect and prevent stuck agents
---

# Loop Detection

Automatically detect when agents are stuck in loops.

## Detection Types

| Type | Description |
|------|-------------|
| Repeated outputs | Same output N times |
| No state change | N steps with no state update |
| Ping-pong | A→B→A→B pattern |

## Configuration

```python
from splinter.types import LoopDetectionConfig

config = LoopDetectionConfig(
    max_repeated_outputs=3,   # Flag after 3 identical outputs
    max_no_state_change=5,    # Flag after 5 steps with no change
    max_ping_pong=4,          # Flag A↔B ping-pong cycles
    window_size=20,           # Analyze last 20 steps
)
```

## Usage

```python
from splinter.control import LoopDetector

detector = LoopDetector(config=config)

# Record steps
detector.record_step(
    agent_id="researcher",
    output="same output",
    state_hash="abc123",
)

# Check for loops
detector.check_loops()  # Raises LoopDetectedError if detected
```

## Error Handling

```python
from splinter.exceptions import LoopDetectedError

try:
    await workflow.run()
except LoopDetectedError as e:
    print(f"Loop detected: {e.pattern}")
    print(f"Occurrences: {e.occurrences}")
```

## With Gateway

```python
from splinter import Gateway

gateway = Gateway(
    loop_detection=LoopDetectionConfig(
        max_repeated_outputs=3,
    )
)
# Gateway automatically checks for loops after each call
```
